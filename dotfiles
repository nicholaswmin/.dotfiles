#!/usr/bin/env zsh
echo "=== TESTING LINK COMMAND ==="
export DOTFILES_ROOT="$PWD" 
export DOTFILES_HOME="$PWD/home"

# Create fake home with test file
export TEST_HOME="/tmp/test-home-$$"
mkdir -p "$TEST_HOME"
echo "test config content" > "$TEST_HOME/.testrc"

echo "=== TEST 1: Link existing file ==="
echo "Before link:"
echo "Test file exists: $(test -f "$TEST_HOME/.testrc" && echo "YES" || echo "NO")"

HOME="$TEST_HOME" ./dotfiles link "$TEST_HOME/.testrc"

echo "After link:"
echo "Test file is symlink: $(test -L "$TEST_HOME/.testrc" && echo "YES" || echo "NO")"
echo "Repo file exists: $(test -f "$PWD/home/.testrc" && echo "YES" || echo "NO")"

echo "=== TEST 2: Link non-existent file ==="
echo "Testing non-existent file:"
HOME="$TEST_HOME" ./dotfiles link "$TEST_HOME/.nonexistent"

echo "=== TEST 3: Link with no arguments ==="
echo "Testing no arguments:"
HOME="$TEST_HOME" ./dotfiles link

# Cleanup
rm -rf "$TEST_HOME"
echo "=== DONE ==="